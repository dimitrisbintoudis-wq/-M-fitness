<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1f1a24">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>M Fitness</title>
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;M Fitness&quot;,&quot;short_name&quot;:&quot;M Fitness&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%231f1a24&quot;,&quot;theme_color&quot;:&quot;%231f1a24&quot;}">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --primary: #e8a0b4;
      --primary-light: #f0c4d0;
      --primary-dim: rgba(232, 160, 180, 0.15);
      --secondary: #f5d5e0;
      --success: #9ed4be;
      --warning: #f5daa0;
      --danger: #e8a0a0;
      --bg: #1f1a24;
      --bg-card: #2a2430;
      --bg-input: #352f3a;
      --text: #f8f4f6;
      --text-dim: #c8bec4;
      --border: rgba(232, 160, 180, 0.2);
    }
    
    .light-mode {
      --bg: #faf8f9;
      --bg-card: #ffffff;
      --bg-input: #f0eaed;
      --text: #2d2830;
      --text-dim: #6b6068;
      --border: rgba(232, 160, 180, 0.3);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Header */
    .header {
      background: var(--bg-card);
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      width: 36px;
      height: 36px;
      background: var(--primary-dim);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-icon svg { width: 20px; height: 20px; stroke: var(--primary); }
    
    .logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .workout-timer {
      font-size: 14px;
      color: var(--primary);
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    
    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: none;
      background: var(--bg-input);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .theme-toggle svg { width: 20px; height: 20px; }
    
    /* Navigation */
    .nav {
      display: flex;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 61px;
      z-index: 99;
    }
    
    .nav-btn {
      flex: 1;
      padding: 12px 8px;
      border: none;
      background: transparent;
      color: var(--text-dim);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }
    
    .nav-btn.active {
      color: var(--primary);
      background: var(--primary-dim);
    }
    
    .nav-btn svg { width: 20px; height: 20px; }
    
    /* Main Content */
    .main { padding: 16px; padding-bottom: 100px; }
    
    /* Cards */
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid var(--border);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title svg { width: 18px; height: 18px; stroke: var(--primary); }
</style>
</head>
<body>
<div id="app"></div>
<script>
// ============ DATA ============
const EXERCISES = {
  glutes: {
    emoji: 'ðŸ‘',
    name: 'Glutes',
    exercises: ['Hip Thrust Machine', 'Cable Kickback', 'Hip Abduction Machine', 'Hip Adduction Machine', 'Glute Bridge', 'Cable Pull-Through']
  },
  legs: {
    emoji: 'ðŸ¦µ',
    name: 'Legs', 
    exercises: ['Leg Press', 'Leg Extension', 'Lying Leg Curl', 'Seated Leg Curl', 'Smith Squat', 'Hack Squat', 'Calf Raise', 'DB Squat', 'Goblet Squat', 'DB Lunges']
  },
  chestBack: {
    emoji: 'ðŸ’ª',
    name: 'Chest & Back',
    exercises: ['Chest Press Machine', 'Pec Deck', 'Lat Pulldown', 'Seated Row', 'Assisted Pull-up', 'Cable Face Pulls']
  },
  shoulders: {
    emoji: 'ðŸ‹ï¸',
    name: 'Shoulders',
    exercises: ['Shoulder Press Machine', 'DB Shoulder Press', 'DB Lateral Raise', 'DB Front Raise', 'DB Rear Delt Raise']
  },
  biceps: {
    emoji: 'ðŸ’ª',
    name: 'Biceps',
    exercises: ['DB Bicep Curl', 'DB Hammer Curl', 'Concentration Curl', 'Cable Bicep Curl']
  },
  triceps: {
    emoji: 'ðŸ’ª',
    name: 'Triceps',
    exercises: ['Tricep Pushdown', 'DB Tricep Kickback', 'DB Overhead Extension', 'Skull Crushers']
  },
  core: {
    emoji: 'ðŸ§˜',
    name: 'Core',
    exercises: ['Ab Crunch Machine', 'Cable Crunch', 'Back Extension', 'Plank']
  },
  cardio: {
    emoji: 'â¤ï¸',
    name: 'Cardio',
    exercises: ['Stair Climber', 'Incline Treadmill', 'Elliptical', 'Stationary Bike'],
    isCardio: true
  }
};

const CARDIO_EXERCISES = ['Stair Climber', 'Incline Treadmill', 'Elliptical', 'Stationary Bike'];

const PROGRAMS = {
  gluteFocus: {
    name: 'Glute Focus',
    days: [
      { name: 'Glutes + Hamstrings', exercises: ['Hip Thrust Machine', 'Cable Kickback', 'Lying Leg Curl', 'Hip Abduction Machine', 'Cable Pull-Through'] },
      { name: 'Quads + Calves', exercises: ['Leg Press', 'Leg Extension', 'Hack Squat', 'Calf Raise', 'Hip Adduction Machine'] },
      { name: 'Full Lower', exercises: ['Smith Squat', 'Hip Thrust Machine', 'Seated Leg Curl', 'Leg Extension', 'Glute Bridge'] }
    ]
  },
  fullBody: {
    name: 'Full Body Toning',
    days: [
      { name: 'Push', exercises: ['Chest Press Machine', 'Shoulder Press Machine', 'Tricep Pushdown', 'Pec Deck', 'DB Lateral Raise'] },
      { name: 'Pull + Core', exercises: ['Lat Pulldown', 'Seated Row', 'Cable Bicep Curl', 'Cable Face Pulls', 'Ab Crunch Machine'] },
      { name: 'Legs + Glutes', exercises: ['Leg Press', 'Hip Thrust Machine', 'Leg Extension', 'Lying Leg Curl', 'Hip Abduction Machine'] }
    ]
  },
  upperLower: {
    name: 'Upper/Lower Split',
    days: [
      { name: 'Upper A', exercises: ['Chest Press Machine', 'Lat Pulldown', 'Shoulder Press Machine', 'Cable Bicep Curl', 'Tricep Pushdown'] },
      { name: 'Lower A', exercises: ['Leg Press', 'Hip Thrust Machine', 'Leg Extension', 'Lying Leg Curl', 'Calf Raise'] },
      { name: 'Upper B', exercises: ['Seated Row', 'Pec Deck', 'DB Shoulder Press', 'DB Hammer Curl', 'DB Overhead Extension'] },
      { name: 'Lower B', exercises: ['Smith Squat', 'Hip Abduction Machine', 'Hack Squat', 'Seated Leg Curl', 'Cable Pull-Through'] }
    ]
  }
};

const SET_TYPES = [
  { id: 'W', label: 'Warmup', color: '#f5daa0' },
  { id: '1', label: 'Working 1', color: '#e8a0b4' },
  { id: '2', label: 'Working 2', color: '#e8a0b4' },
  { id: '3', label: 'Working 3', color: '#e8a0b4' },
  { id: 'F', label: 'Failure', color: '#e8a0a0' }
];

// ============ STATE ============
let state = {
  activeTab: 'workout',
  currentWorkout: null,
  workouts: [],
  personalRecords: {},
  selectedProgram: 'gluteFocus',
  settings: {
    restTimer: { default: 90, sound: true, vibration: true },
    units: 'kg',
    theme: 'dark'
  },
  restTimer: { active: false, remaining: 0, total: 0 },
  workoutStartTime: null
};

// ============ STORAGE ============
function loadData() {
  try {
    const saved = localStorage.getItem('mFitnessData');
    if (saved) {
      const data = JSON.parse(saved);
      state.workouts = data.workouts || [];
      state.personalRecords = data.personalRecords || {};
      state.selectedProgram = data.selectedProgram || 'gluteFocus';
      state.settings = { ...state.settings, ...data.settings };
      if (state.settings.theme === 'light') {
        document.body.classList.add('light-mode');
      }
    }
  } catch(e) { console.error('Load error:', e); }
}

function saveData() {
  try {
    localStorage.setItem('mFitnessData', JSON.stringify({
      workouts: state.workouts,
      personalRecords: state.personalRecords,
      selectedProgram: state.selectedProgram,
      settings: state.settings
    }));
  } catch(e) { console.error('Save error:', e); }
}

// ============ TIMER FUNCTIONS ============
let timerInterval = null;
let workoutInterval = null;

function startRestTimer(seconds) {
  state.restTimer = { active: true, remaining: seconds, total: seconds };
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    state.restTimer.remaining--;
    if (state.restTimer.remaining <= 0) {
      stopRestTimer();
      if (state.settings.restTimer.sound) playBeep();
      if (state.settings.restTimer.vibration && navigator.vibrate) navigator.vibrate([200, 100, 200]);
    }
    render();
  }, 1000);
  render();
}

function stopRestTimer() {
  state.restTimer.active = false;
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = null;
}

function playBeep() {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = 800;
    gain.gain.value = 0.3;
    osc.start();
    osc.stop(ctx.currentTime + 0.3);
  } catch(e) {}
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return `${m}:${s.toString().padStart(2, '0')}`;
}

function getWorkoutDuration() {
  if (!state.workoutStartTime) return '0:00';
  const elapsed = Math.floor((Date.now() - state.workoutStartTime) / 1000);
  return formatTime(elapsed);
}

// ============ WORKOUT FUNCTIONS ============
function startWorkout(name, exercises) {
  state.currentWorkout = {
    id: Date.now(),
    name,
    date: new Date().toISOString(),
    exercises: exercises.map(ex => ({
      name: ex,
      type: CARDIO_EXERCISES.includes(ex) ? 'cardio' : 'strength',
      sets: CARDIO_EXERCISES.includes(ex) ? [] : [{ type: '1', weight: '', reps: '', completed: false }],
      duration: '',
      distance: '',
      calories: ''
    }))
  };
  state.workoutStartTime = Date.now();
  workoutInterval = setInterval(render, 1000);
  state.activeTab = 'workout';
  autoFillFromHistory();
  render();
}

function autoFillFromHistory() {
  if (!state.currentWorkout) return;
  state.currentWorkout.exercises.forEach(ex => {
    if (ex.type === 'strength') {
      const lastWorkout = state.workouts.find(w => 
        w.exercises.some(e => e.name === ex.name && e.type === 'strength')
      );
      if (lastWorkout) {
        const lastEx = lastWorkout.exercises.find(e => e.name === ex.name);
        if (lastEx && lastEx.sets && lastEx.sets.length > 0) {
          const lastSet = lastEx.sets.find(s => s.completed) || lastEx.sets[0];
          if (lastSet) {
            ex.sets[0].weight = lastSet.weight;
            ex.sets[0].reps = lastSet.reps;
          }
        }
      }
    }
  });
}

function finishWorkout() {
  if (!state.currentWorkout) return;
  state.currentWorkout.completedAt = new Date().toISOString();
  state.currentWorkout.duration = Math.floor((Date.now() - state.workoutStartTime) / 1000);
  
  // Update PRs
  state.currentWorkout.exercises.forEach(ex => {
    if (ex.type === 'strength') {
      ex.sets.forEach(set => {
        if (set.completed && set.weight && set.reps) {
          const pr = state.personalRecords[ex.name];
          if (!pr || parseFloat(set.weight) > parseFloat(pr.weight)) {
            state.personalRecords[ex.name] = {
              weight: set.weight,
              reps: set.reps,
              date: new Date().toISOString()
            };
          }
        }
      });
    }
  });
  
  state.workouts.unshift(state.currentWorkout);
  state.currentWorkout = null;
  state.workoutStartTime = null;
  if (workoutInterval) clearInterval(workoutInterval);
  stopRestTimer();
  saveData();
  render();
}

function cancelWorkout() {
  if (confirm('Cancel workout? All progress will be lost.')) {
    state.currentWorkout = null;
    state.workoutStartTime = null;
    if (workoutInterval) clearInterval(workoutInterval);
    stopRestTimer();
    render();
  }
}

function addSet(exerciseIndex) {
  const ex = state.currentWorkout.exercises[exerciseIndex];
  if (ex.type === 'strength') {
    const lastSet = ex.sets[ex.sets.length - 1];
    ex.sets.push({
      type: '1',
      weight: lastSet?.weight || '',
      reps: lastSet?.reps || '',
      completed: false
    });
    render();
  }
}

function removeSet(exerciseIndex, setIndex) {
  const ex = state.currentWorkout.exercises[exerciseIndex];
  ex.sets.splice(setIndex, 1);
  if (ex.sets.length === 0) {
    ex.sets.push({ type: '1', weight: '', reps: '', completed: false });
  }
  render();
}

function toggleSetComplete(exerciseIndex, setIndex) {
  const set = state.currentWorkout.exercises[exerciseIndex].sets[setIndex];
  set.completed = !set.completed;
  if (set.completed && state.settings.restTimer.default > 0) {
    startRestTimer(state.settings.restTimer.default);
  }
  render();
}

function updateSet(exerciseIndex, setIndex, field, value) {
  state.currentWorkout.exercises[exerciseIndex].sets[setIndex][field] = value;
}

function updateCardio(exerciseIndex, field, value) {
  state.currentWorkout.exercises[exerciseIndex][field] = value;
}

function cycleSetType(exerciseIndex, setIndex) {
  const set = state.currentWorkout.exercises[exerciseIndex].sets[setIndex];
  const types = ['W', '1', '2', '3', 'F'];
  const idx = types.indexOf(set.type);
  set.type = types[(idx + 1) % types.length];
  render();
}

function addExerciseToWorkout(name) {
  if (!state.currentWorkout) return;
  state.currentWorkout.exercises.push({
    name,
    type: CARDIO_EXERCISES.includes(name) ? 'cardio' : 'strength',
    sets: CARDIO_EXERCISES.includes(name) ? [] : [{ type: '1', weight: '', reps: '', completed: false }],
    duration: '',
    distance: '',
    calories: ''
  });
  render();
}

function removeExercise(index) {
  state.currentWorkout.exercises.splice(index, 1);
  render();
}

// ============ SETTINGS & EXPORT ============
function toggleTheme() {
  state.settings.theme = state.settings.theme === 'dark' ? 'light' : 'dark';
  document.body.classList.toggle('light-mode');
  saveData();
  render();
}

function exportData() {
  const data = JSON.stringify({
    workouts: state.workouts,
    personalRecords: state.personalRecords,
    selectedProgram: state.selectedProgram,
    settings: state.settings,
    exportDate: new Date().toISOString()
  }, null, 2);
  
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `m-fitness-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target.result);
        if (data.workouts) state.workouts = data.workouts;
        if (data.personalRecords) state.personalRecords = data.personalRecords;
        if (data.selectedProgram) state.selectedProgram = data.selectedProgram;
        if (data.settings) state.settings = { ...state.settings, ...data.settings };
        saveData();
        alert('Data imported successfully!');
        render();
      } catch(e) {
        alert('Invalid backup file');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

// ============ ICONS ============
const icons = {
  dumbbell: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5h11M6.5 17.5h11M3 10.5V6.5a1 1 0 0 1 1-1h1.5a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-4M21 10.5V6.5a1 1 0 0 0-1-1h-1.5a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1H20a1 1 0 0 0 1-1v-4"/></svg>',
  calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>',
  trophy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>',
  settings: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',
  plus: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>',
  check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>',
  x: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>',
  play: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>',
  pause: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>',
  sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',
  moon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
  clock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
  trash: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',
  download: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
  upload: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',
  heart: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>'
};

// ============ RENDER ============
function render() {
  const app = document.getElementById('app');
  
  app.innerHTML = `
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">${icons.dumbbell}</div>
        <span class="logo-text">M Fitness</span>
      </div>
      <div class="header-right">
        ${state.currentWorkout ? `<span class="workout-timer">${icons.clock} ${getWorkoutDuration()}</span>` : ''}
        <button class="theme-toggle" onclick="toggleTheme()">
          ${state.settings.theme === 'dark' ? icons.sun : icons.moon}
        </button>
      </div>
    </header>
    
    <!-- Navigation -->
    <nav class="nav">
      <button class="nav-btn ${state.activeTab === 'workout' ? 'active' : ''}" onclick="state.activeTab='workout';render()">
        ${icons.dumbbell}
        <span>Workout</span>
      </button>
      <button class="nav-btn ${state.activeTab === 'programs' ? 'active' : ''}" onclick="state.activeTab='programs';render()">
        ${icons.calendar}
        <span>Programs</span>
      </button>
      <button class="nav-btn ${state.activeTab === 'records' ? 'active' : ''}" onclick="state.activeTab='records';render()">
        ${icons.trophy}
        <span>PRs</span>
      </button>
      <button class="nav-btn ${state.activeTab === 'settings' ? 'active' : ''}" onclick="state.activeTab='settings';render()">
        ${icons.settings}
        <span>Settings</span>
      </button>
    </nav>
    
    <!-- Main Content -->
    <main class="main">
      ${renderTab()}
    </main>
    
    <!-- Rest Timer Overlay -->
    ${state.restTimer.active ? renderRestTimer() : ''}
  `;
}

function renderTab() {
  switch(state.activeTab) {
    case 'workout': return renderWorkoutTab();
    case 'programs': return renderProgramsTab();
    case 'records': return renderRecordsTab();
    case 'settings': return renderSettingsTab();
    default: return '';
  }
}

function renderRestTimer() {
  const progress = (state.restTimer.remaining / state.restTimer.total) * 100;
  return `
    <div style="position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;">
      <div style="font-size:72px;font-weight:700;color:var(--primary);margin-bottom:16px;">${formatTime(state.restTimer.remaining)}</div>
      <div style="width:200px;height:8px;background:var(--bg-input);border-radius:4px;overflow:hidden;margin-bottom:24px;">
        <div style="width:${progress}%;height:100%;background:var(--primary);transition:width 1s linear;"></div>
      </div>
      <div style="display:flex;gap:12px;">
        <button onclick="state.restTimer.remaining+=15;render()" style="padding:12px 20px;background:var(--bg-input);border:none;border-radius:10px;color:var(--text);font-size:14px;cursor:pointer;">+15s</button>
        <button onclick="stopRestTimer();render()" style="padding:12px 20px;background:var(--danger);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer;">Skip</button>
      </div>
    </div>
  `;
}

function renderWorkoutTab() {
  if (!state.currentWorkout) {
    return renderStartWorkout();
  }
  return renderActiveWorkout();
}

function renderStartWorkout() {
  const program = PROGRAMS[state.selectedProgram];
  return `
    <div class="card">
      <div class="card-title">${icons.play} Start Workout</div>
      <button onclick="startWorkout('Custom Workout', [])" style="width:100%;padding:16px;background:var(--primary-dim);border:1px solid var(--primary);border-radius:12px;color:var(--text);font-size:15px;cursor:pointer;display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        ${icons.plus} Custom Workout
      </button>
      
      <div style="color:var(--text-dim);font-size:13px;margin:16px 0 8px;">From ${program.name}:</div>
      ${program.days.map((day, i) => `
        <button onclick="startWorkout('${program.name} - ${day.name}', ${JSON.stringify(day.exercises)})" 
          style="width:100%;padding:14px 16px;background:var(--bg-input);border:none;border-radius:12px;color:var(--text);font-size:14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <span>${day.name}</span>
          <span style="color:var(--text-dim);font-size:12px;">${day.exercises.length} exercises</span>
        </button>
      `).join('')}
    </div>
    
    ${state.workouts.length > 0 ? `
      <div class="card">
        <div class="card-title">${icons.clock} Recent Workouts</div>
        ${state.workouts.slice(0, 5).map(w => `
          <div style="padding:12px;background:var(--bg-input);border-radius:10px;margin-bottom:8px;">
            <div style="font-weight:500;margin-bottom:4px;">${w.name}</div>
            <div style="font-size:12px;color:var(--text-dim);">
              ${new Date(w.date).toLocaleDateString('el-GR')} â€¢ ${w.exercises.length} exercises ${w.duration ? 'â€¢ ' + formatTime(w.duration) : ''}
            </div>
          </div>
        `).join('')}
      </div>
    ` : ''}
  `;
}

function renderActiveWorkout() {
  return `
    <!-- Workout Header -->
    <div class="card" style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-weight:600;">${state.currentWorkout.name}</div>
        <div style="font-size:12px;color:var(--text-dim);">${new Date(state.currentWorkout.date).toLocaleDateString('el-GR')}</div>
      </div>
      <div style="display:flex;gap:8px;">
        <button onclick="cancelWorkout()" style="padding:10px;background:var(--danger);background:rgba(232,160,160,0.2);border:none;border-radius:10px;color:var(--danger);cursor:pointer;">
          ${icons.x}
        </button>
        <button onclick="finishWorkout()" style="padding:10px 16px;background:var(--success);background:rgba(158,212,190,0.2);border:none;border-radius:10px;color:var(--success);cursor:pointer;display:flex;align-items:center;gap:6px;font-weight:500;">
          ${icons.check} Finish
        </button>
      </div>
    </div>
    
    <!-- Exercises -->
    ${state.currentWorkout.exercises.map((ex, exIdx) => 
      ex.type === 'cardio' ? renderCardioExercise(ex, exIdx) : renderStrengthExercise(ex, exIdx)
    ).join('')}
    
    <!-- Add Exercise -->
    <div class="card">
      <div class="card-title">${icons.plus} Add Exercise</div>
      <div style="max-height:300px;overflow-y:auto;">
        ${Object.entries(EXERCISES).map(([key, cat]) => `
          <div style="margin-bottom:12px;">
            <div style="font-size:13px;color:var(--text-dim);margin-bottom:8px;">${cat.emoji} ${cat.name}</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
              ${cat.exercises.filter(ex => !state.currentWorkout.exercises.some(e => e.name === ex)).map(ex => `
                <button onclick="addExerciseToWorkout('${ex}')" 
                  style="padding:10px 8px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);font-size:12px;cursor:pointer;text-align:left;">
                  ${ex}
                </button>
              `).join('')}
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function renderStrengthExercise(ex, exIdx) {
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div class="card-title" style="margin-bottom:0;">${icons.dumbbell} ${ex.name}</div>
        <button onclick="removeExercise(${exIdx})" style="padding:8px;background:transparent;border:none;color:var(--text-dim);cursor:pointer;">${icons.trash}</button>
      </div>
      
      <!-- Header Row -->
      <div style="display:grid;grid-template-columns:44px 1fr 1fr 44px 44px;gap:6px;margin-bottom:8px;padding:0 4px;">
        <div style="font-size:11px;color:var(--text-dim);text-align:center;">TYPE</div>
        <div style="font-size:11px;color:var(--text-dim);text-align:center;">KG</div>
        <div style="font-size:11px;color:var(--text-dim);text-align:center;">REPS</div>
        <div></div>
        <div></div>
      </div>
      
      <!-- Sets -->
      ${ex.sets.map((set, setIdx) => `
        <div style="display:grid;grid-template-columns:44px 1fr 1fr 44px 44px;gap:6px;margin-bottom:6px;">
          <button onclick="cycleSetType(${exIdx},${setIdx})" 
            style="height:44px;background:${SET_TYPES.find(t=>t.id===set.type)?.color || 'var(--primary)'}33;border:none;border-radius:8px;color:${SET_TYPES.find(t=>t.id===set.type)?.color || 'var(--primary)'};font-weight:600;font-size:13px;cursor:pointer;">
            ${set.type}
          </button>
          <input type="number" inputmode="decimal" value="${set.weight}" placeholder="0" onchange="updateSet(${exIdx},${setIdx},'weight',this.value)"
            style="height:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);text-align:center;font-size:16px;width:100%;">
          <input type="number" inputmode="numeric" value="${set.reps}" placeholder="0" onchange="updateSet(${exIdx},${setIdx},'reps',this.value)"
            style="height:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);text-align:center;font-size:16px;width:100%;">
          <button onclick="toggleSetComplete(${exIdx},${setIdx})"
            style="height:44px;width:44px;background:${set.completed ? 'var(--success)' : 'var(--bg-input)'};border:none;border-radius:8px;color:${set.completed ? '#fff' : 'var(--text-dim)'};cursor:pointer;">
            ${icons.check}
          </button>
          <button onclick="removeSet(${exIdx},${setIdx})"
            style="height:44px;width:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text-dim);cursor:pointer;">
            ${icons.trash}
          </button>
        </div>
      `).join('')}
      
      <button onclick="addSet(${exIdx})" 
        style="width:100%;padding:12px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text-dim);font-size:13px;cursor:pointer;margin-top:4px;">
        + Add Set
      </button>
    </div>
  `;
}

function renderCardioExercise(ex, exIdx) {
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div class="card-title" style="margin-bottom:0;">${icons.heart} ${ex.name}</div>
        <button onclick="removeExercise(${exIdx})" style="padding:8px;background:transparent;border:none;color:var(--text-dim);cursor:pointer;">${icons.trash}</button>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
        <div>
          <label style="font-size:11px;color:var(--text-dim);display:block;margin-bottom:4px;">DURATION</label>
          <input type="text" value="${ex.duration}" placeholder="mm:ss" onchange="updateCardio(${exIdx},'duration',this.value)"
            style="width:100%;height:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);text-align:center;font-size:16px;">
        </div>
        <div>
          <label style="font-size:11px;color:var(--text-dim);display:block;margin-bottom:4px;">DISTANCE (km)</label>
          <input type="number" inputmode="decimal" value="${ex.distance}" placeholder="0" onchange="updateCardio(${exIdx},'distance',this.value)"
            style="width:100%;height:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);text-align:center;font-size:16px;">
        </div>
        <div>
          <label style="font-size:11px;color:var(--text-dim);display:block;margin-bottom:4px;">CALORIES</label>
          <input type="number" inputmode="numeric" value="${ex.calories}" placeholder="0" onchange="updateCardio(${exIdx},'calories',this.value)"
            style="width:100%;height:44px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);text-align:center;font-size:16px;">
        </div>
      </div>
    </div>
  `;
}

function renderProgramsTab() {
  return `
    <div class="card">
      <div class="card-title">${icons.calendar} Select Program</div>
      ${Object.entries(PROGRAMS).map(([key, program]) => `
        <button onclick="state.selectedProgram='${key}';saveData();render()"
          style="width:100%;padding:16px;background:${state.selectedProgram === key ? 'var(--primary-dim)' : 'var(--bg-input)'};border:${state.selectedProgram === key ? '1px solid var(--primary)' : 'none'};border-radius:12px;color:var(--text);cursor:pointer;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <div style="text-align:left;">
            <div style="font-weight:500;">${program.name}</div>
            <div style="font-size:12px;color:var(--text-dim);">${program.days.length} days per week</div>
          </div>
          ${state.selectedProgram === key ? `<span style="color:var(--primary);">${icons.check}</span>` : ''}
        </button>
      `).join('')}
    </div>
    
    <div class="card">
      <div class="card-title">${icons.calendar} ${PROGRAMS[state.selectedProgram].name} Schedule</div>
      ${PROGRAMS[state.selectedProgram].days.map((day, i) => `
        <div style="padding:14px;background:var(--bg-input);border-radius:10px;margin-bottom:8px;">
          <div style="font-weight:500;margin-bottom:8px;">${day.name}</div>
          <div style="display:flex;flex-wrap:wrap;gap:6px;">
            ${day.exercises.map(ex => `
              <span style="padding:4px 10px;background:var(--primary-dim);border-radius:6px;font-size:11px;color:var(--primary);">${ex}</span>
            `).join('')}
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderRecordsTab() {
  const prs = Object.entries(state.personalRecords).sort((a, b) => parseFloat(b[1].weight) - parseFloat(a[1].weight));
  
  return `
    <div class="card">
      <div class="card-title">${icons.trophy} Personal Records</div>
      ${prs.length > 0 ? prs.map(([exercise, pr]) => `
        <div style="padding:14px;background:var(--bg-input);border-radius:10px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:500;">${exercise}</div>
            <div style="font-size:12px;color:var(--text-dim);">${new Date(pr.date).toLocaleDateString('el-GR')}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:20px;font-weight:700;color:var(--primary);">${pr.weight} kg</div>
            <div style="font-size:12px;color:var(--text-dim);">${pr.reps} reps</div>
          </div>
        </div>
      `).join('') : `
        <div style="text-align:center;padding:40px;color:var(--text-dim);">
          <div style="margin-bottom:8px;">${icons.trophy}</div>
          <div>No personal records yet.</div>
          <div style="font-size:13px;">Complete workouts to set PRs!</div>
        </div>
      `}
    </div>
  `;
}

function renderSettingsTab() {
  return `
    <div class="card">
      <div class="card-title">${icons.settings} Settings</div>
      
      <!-- Rest Timer -->
      <div style="margin-bottom:20px;">
        <label style="font-size:13px;color:var(--text-dim);display:block;margin-bottom:8px;">Default Rest Timer (seconds)</label>
        <div style="display:flex;gap:8px;">
          ${[60, 90, 120, 180].map(sec => `
            <button onclick="state.settings.restTimer.default=${sec};saveData();render()"
              style="flex:1;padding:12px;background:${state.settings.restTimer.default === sec ? 'var(--primary)' : 'var(--bg-input)'};border:none;border-radius:8px;color:${state.settings.restTimer.default === sec ? '#fff' : 'var(--text)'};cursor:pointer;font-size:14px;">
              ${sec}s
            </button>
          `).join('')}
        </div>
      </div>
      
      <!-- Sound & Vibration -->
      <div style="margin-bottom:20px;">
        <label style="font-size:13px;color:var(--text-dim);display:block;margin-bottom:8px;">Timer Alerts</label>
        <div style="display:flex;gap:8px;">
          <button onclick="state.settings.restTimer.sound=!state.settings.restTimer.sound;saveData();render()"
            style="flex:1;padding:12px;background:${state.settings.restTimer.sound ? 'var(--primary)' : 'var(--bg-input)'};border:none;border-radius:8px;color:${state.settings.restTimer.sound ? '#fff' : 'var(--text)'};cursor:pointer;">
            ðŸ”Š Sound ${state.settings.restTimer.sound ? 'ON' : 'OFF'}
          </button>
          <button onclick="state.settings.restTimer.vibration=!state.settings.restTimer.vibration;saveData();render()"
            style="flex:1;padding:12px;background:${state.settings.restTimer.vibration ? 'var(--primary)' : 'var(--bg-input)'};border:none;border-radius:8px;color:${state.settings.restTimer.vibration ? '#fff' : 'var(--text)'};cursor:pointer;">
            ðŸ“³ Vibration ${state.settings.restTimer.vibration ? 'ON' : 'OFF'}
          </button>
        </div>
      </div>
      
      <!-- Theme -->
      <div style="margin-bottom:20px;">
        <label style="font-size:13px;color:var(--text-dim);display:block;margin-bottom:8px;">Theme</label>
        <button onclick="toggleTheme()"
          style="width:100%;padding:14px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
          ${state.settings.theme === 'dark' ? icons.moon + ' Dark Mode' : icons.sun + ' Light Mode'}
        </button>
      </div>
    </div>
    
    <!-- Export/Import -->
    <div class="card">
      <div class="card-title">${icons.download} Backup & Restore</div>
      <div style="display:flex;gap:8px;">
        <button onclick="exportData()"
          style="flex:1;padding:14px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
          ${icons.download} Export
        </button>
        <button onclick="importData()"
          style="flex:1;padding:14px;background:var(--bg-input);border:none;border-radius:8px;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
          ${icons.upload} Import
        </button>
      </div>
      <div style="font-size:11px;color:var(--text-dim);margin-top:12px;text-align:center;">
        ${state.workouts.length} workouts â€¢ ${Object.keys(state.personalRecords).length} PRs saved
      </div>
    </div>
    
    <!-- Stats -->
    <div class="card">
      <div class="card-title">${icons.trophy} Stats</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div style="padding:16px;background:var(--bg-input);border-radius:10px;text-align:center;">
          <div style="font-size:28px;font-weight:700;color:var(--primary);">${state.workouts.length}</div>
          <div style="font-size:12px;color:var(--text-dim);">Total Workouts</div>
        </div>
        <div style="padding:16px;background:var(--bg-input);border-radius:10px;text-align:center;">
          <div style="font-size:28px;font-weight:700;color:var(--primary);">${Object.keys(state.personalRecords).length}</div>
          <div style="font-size:12px;color:var(--text-dim);">Personal Records</div>
        </div>
      </div>
    </div>
  `;
}

// ============ INIT ============
loadData();
render();
</script>
</body>
</html>
